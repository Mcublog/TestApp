# SawAnalyser v0.1

Программа SawAnalyser v0.1 производит простейший анализ текстовых файлов, содержащих имитацию данных с датчика.

# Общие описание программы
В папку TestData попадают текстовые файлы, содержание выборки с датчика. (Примечание: к сожалению, не реализовал проверку на корректность данных в этих файлах) Генерацию этих данных обеспечивает python скрипт, расположенный в директории SawGen. При его запуске генерируется текстовые файлы, которые можно подать на выход SawAnalyser.
SawAnalyser v0.1 производит простейший анализ этих файлов, анализируется:
 	- Минимальная и максимальная амплитуда сигнала, допускается некоторое отклонение (AMPLITUDE_ERROR), которое можно задать.
 	- Длительность импульса, подразумевается, что частота дискретизации остается постоянная на протяжении всего времени работы датчика.
 	- Форма сигнала, производиться простейшая оценка формы сигнала. Сравнивается амплитуда одного семпла и амплитуда следующего за ним. Амплитуда последующего семпла всегда должна быть строго больше предыдущего.
Каждый текстовый файл, содержит выборку одного пилообразного импульса с датчика.
# Описание алгоритма работы программы SawAnalyser
Программа с интервалом 1 секунда просматривает содержимое рабочей директории TestData, на наличие текстовых файлов, созданных скриптом SawGen. Как только, там появляется файл, он переносится в папку Tested, затем программа создает отдельный поток, в котором происходит анализ сигнала, содержащегося в файле. 
Функция анализа на время вывода результатов в стандартный поток вывода, захватывает мьютекс m_ostream, чтобы не допустить мешанины данных из разных потоков.
Результаты выводятся в формате csv. Если перенаправить поток вывода на csv файл, то в дальнейшем его возможно будет открыть, например, табличным процессором OpenOffice Calc. 
# Конфигурирование SawAnalyser
Программа допускает несколько способов конфигурирования параметров оценки сигнала: 
-	При запуске программы с помощью аргументов (Примечание: есть простейшая проверка на корректность данных).
-	Во время работы с помощью набора с клавиатуры строки “cfg” (Примечание: есть простейшая проверка на корректность данных). При получении данной строки программы приостановит обработку файлов и будет дожидаться, ввода новых значений параметров. После ввода значений SawAnalyser продолжит свою работу.
Если некоторые данные не введены или введены некорректные значения, то будут установлены значения по умолчанию.
Параметры конфигурирования:
-	Error_only (-erronly (ключе аргумента)): 0 – выводит, результаты анализа даже если сигнал прошел все проверки, 1 – выводит только результаты тех сигналов, которые не прошли проверку (bool).
-	Amplitude_max  (-amax) максимальная амплитуда сигнала (int).
-	Amplitude_min  (-amin) минимальная амплитуда сигнала (int).
-	Amplitude_error (-aerr) допустимое отклонение максимальной и минимальной амплитуды от номинального (int).
-	Width (-width) длительность импульса (int).
Все параметры оценки вводятся в условных единицах.
Структура данных, описывающая контрольные параметры:
        struct TEST_PARAM
        {
            int aml_min;
            int aml_max;
            int err;
            int width;
        }test_parameter;
Пример вывода данной структуры в стандартный поток вывода.
AMPLITUDE_MIN,0
AMPLITUDE_MAX,480
AMPLITUDE_ERR,20
PULSE_WIDTH,50
# Описание результатов анализов
Результат анализа выводиться в формате csv. Результат содержит краткую информацию об анализе сигнала. Для наглядности буду описывать непосредственно саму структуры данных результата.
        struct RESULT
        {
            bool form_tst; -- признак прохождение теста формы сигнала.
            int  bad_sample_num; -- номер семпла в файле, который содержит помеху.

            AMPLITUDE_ERRORS ampl_test; -- краткий результат прохождения теста амплитуды (описание см. ниже)
            int aml_min_err; -- минимальная амплитуда сигнала, текущего сигнала.
            int aml_max_err; -- максимальная амплитуда сигнала, текущего сигнала.

            bool widht_test; -- признак прохождения теста длительности импульса.
            int  width_err; -- значение длительности импульса, текущего сигнала.
        }result_t;
        enum AMPLITUDE_ERRORS
        {
            AMPL_NORM, -- амплитуда в норме
            AMPL_TOO_LOW, -- превышен нижний предел
            AMPL_TOO_HIGHT, -- превышен верхний предел
            AMPL_OUT_BORDER – превышен и верхний и нижний предел
        };
Пример вывода данной структуры в стандартный поток:
TestFile,120.txt // анализируемый файл с выборками
FormTest,1 // тест формы сигнала пройден успешно
AmplTest,SawAnalyzingFunc::AMPL_TOO_HIGHT,MAX_ERR,490 // Амлитуда слишком высокая, значение сигнала 490
WidthTest,0,WIDTH_CURRENT,50 // тест длительности не пройден, текущая длительности сигнала
